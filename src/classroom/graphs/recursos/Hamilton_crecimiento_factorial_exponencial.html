<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>n! vs 2^n — visualización interactiva (con animación)</title>
<style>
  :root{--bg:#0b1020;--panel:#121735;--line:#1e2549;--fg:#e6ecff;--muted:#a9b0d6;--a:#7dd3fc;--b:#ef4444;}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Segoe UI,Roboto,Arial}
  header{padding:16px 18px;border-bottom:1px solid #162046}
  h1{margin:0 0 6px;font-size:20px}
  p.sub{margin:0;color:var(--muted)}
  .wrap{display:grid;grid-template-columns:320px 1fr;gap:16px;padding:16px}
  .panel{background:var(--panel);border:1px solid #1a2246;border-radius:12px;padding:14px}
  .panel h2{margin:0 0 8px;font-size:16px;color:#cfe3ff}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:8px 0}
  input[type=range]{width:180px} input[type=number]{width:80px}
  button{background:#1f2a4a;border:1px solid #2f3a68;color:var(--fg);padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:600}
  button:hover{filter:brightness(1.08)}
  .stat{font-family:ui-monospace,Menlo,monospace;font-size:13px}
  .pill{padding:2px 8px;border-radius:999px;border:1px solid #2a335a}
  .ok{background:rgba(34,197,94,.12);border-color:rgba(34,197,94,.5);color:#86efac}
  .warn{background:rgba(245,158,11,.12);border-color:rgba(245,158,11,.5);color:#fde68a}
  .legend{display:flex;gap:10px;align-items:center;font-size:13px;color:var(--muted)}
  .dot{width:12px;height:12px;border-radius:3px;display:inline-block}
  .a{background:var(--a)} .b{background:var(--b)}
  canvas{width:100%;height:380px;background:#0a0f20;border:1px solid #1a2246;border-radius:10px}
  .note{color:var(--muted);font-size:12px}
  footer{padding:12px 16px;color:#9fb0d9;border-top:1px solid #162046;font-size:12px;text-align:center}
</style>
</head>
<body>
<header>
  <h1>¿Por qué n! crece más rápido que 2ⁿ?</h1>
  <p class="sub">Compara log₁₀(n!) y log₁₀(2ⁿ). A partir de n=4, n! supera 2ⁿ y la brecha solo aumenta.</p>
</header>

<div class="wrap">
  <div class="panel">
    <h2>Controles</h2>
    <div class="row">
      <label>n máx. del gráfico</label>
      <input id="nMax" type="range" min="6" max="400" value="80" oninput="setNmax(this.value)">
      <input id="nMaxNum" type="number" min="6" max="400" value="80" oninput="setNmax(this.value)">
    </div>
    <div class="row">
      <label>Puntero en n</label>
      <input id="n" type="range" min="1" max="400" value="10" oninput="setN(this.value)">
      <input id="nNum" type="number" min="1" max="400" value="10" oninput="setN(this.value)">
      <button id="btnAnim" onclick="toggleAnim(this)">Animar</button>
    </div>

    <div class="legend">
      <span class="dot a"></span> log₁₀(n!) &nbsp;
      <span class="dot b"></span> log₁₀(2ⁿ)
    </div>

    <h2 style="margin-top:10px">Valores en n = <span id="curN">10</span></h2>
    <div class="stat">log₁₀(n!) = <span id="logF">—</span></div>
    <div class="stat">log₁₀(2ⁿ) = <span id="logP">—</span></div>
    <div class="stat">log₁₀(n!/2ⁿ) = <span id="logRatio">—</span>
      <span id="badge" class="pill">—</span>
    </div>
    <div class="stat">Dígitos de n!: <span id="digitsF">—</span> · Dígitos de 2ⁿ: <span id="digitsP">—</span></div>
    <div class="stat" id="exactLine">Valor exacto (si cabe): <span id="exactVal">—</span></div>
    <p class="note">Mostramos dígitos para números enormes (rápido). Para n pequeños se muestra el número exacto.</p>
  </div>

  <div class="panel">
    <h2>Gráfico (escala logarítmica base 10)</h2>
    <canvas id="chart" width="700" height="380"></canvas>
    <div class="note">La línea vertical marca el n actual. Punto de corte: n=4 (n!=24 &gt; 2⁴=16).</div>
  </div>

  <div class="panel">
    <h2>Intuición breve</h2>
    <div class="note">
      • Pendiente en escala log: d/dn[ln n!] ≈ ln n (Stirling) vs d/dn[ln 2ⁿ] = ln 2 (constante).  
      • Producto: n!/2ⁿ = ∏(k/2). Desde k=4, la mayoría de factores &gt; 1, el producto crece sin parar.
    </div>
  </div>
</div>

<footer>
  Material elaborado por el profesor Sergio Gevatschnaider
</footer>

<script>
/* ======= Precálculos de log10(n!) y log10(2^n) ======= */
const MAX_GLOBAL = 400;
const LOG2 = Math.log10(2);
const logFact = new Float64Array(MAX_GLOBAL+1);
const logPow2 = new Float64Array(MAX_GLOBAL+1);
logFact[0]=0;
for(let n=1;n<=MAX_GLOBAL;n++) logFact[n]=logFact[n-1]+Math.log10(n);
for(let n=0;n<=MAX_GLOBAL;n++) logPow2[n]=n*LOG2;

/* ======= Estado, helpers y colores canvas (evitamos var() dentro del canvas) ======= */
let state = { n:10, nMax:80, anim:false, raf:0 };
const COLORS = {
  grid:'#141b35', axes:'#1f2a4a', axisText:'#94a3b8',
  curveA:'#7dd3fc', curveB:'#ef4444', pointer:'#7dd3fc', cross:'#94a3b8'
};
const byId = id => document.getElementById(id);
const clamp = (x,a,b)=>Math.max(a,Math.min(b,x));
const fmt = x => x.toFixed(4);

/* ======= BigInt exacto para n pequeños ======= */
const EXACT_THRESHOLD = 50;
function factorialBigInt(n){ let r=1n; for(let k=2n;k<=BigInt(n);k++) r*=k; return r; }
function pow2BigInt(n){ return 1n<<BigInt(n); }

/* ======= UI numérica ======= */
function updateInfo(){
  const n=state.n, logF=logFact[n], logP=logPow2[n], logRatio=logF-logP;
  const digitsF=Math.floor(logF)+1, digitsP=Math.floor(logP)+1;

  byId('curN').textContent=n;
  byId('logF').textContent=fmt(logF);
  byId('logP').textContent=fmt(logP);
  byId('logRatio').textContent=(logRatio>=0?'+':'')+fmt(logRatio);
  byId('digitsF').textContent=digitsF;
  byId('digitsP').textContent=digitsP;

  const badge=byId('badge');
  if(logRatio>0){ badge.textContent='n! > 2ⁿ'; badge.className='pill ok'; }
  else if(n===4){ badge.textContent='n! = 2ⁿ?'; badge.className='pill warn'; }
  else { badge.textContent='n! ≤ 2ⁿ'; badge.className='pill warn'; }

  const exactLine=byId('exactLine'), exactVal=byId('exactVal');
  if(n<=EXACT_THRESHOLD){
    try{
      const f=factorialBigInt(n), p=pow2BigInt(n);
      exactVal.textContent = `n! = ${f.toString()}  ·  2ⁿ = ${p.toString()}`;
      exactLine.style.display='';
    }catch{ exactLine.style.display='none'; }
  }else{
    exactVal.textContent='— (n grande: mostramos dígitos arriba)';
    exactLine.style.display='';
  }
}

/* ======= Controles ======= */
function setNmax(v){
  v=clamp(+v,6,MAX_GLOBAL);
  state.nMax=v;
  byId('nMax').value=v; byId('nMaxNum').value=v;
  byId('n').max=v; byId('nNum').max=v;
  if(state.n>v) setN(v); else { draw(); updateInfo(); }
}
function setN(v){
  v=clamp(+v,1,state.nMax);
  state.n=v;
  byId('n').value=v; byId('nNum').value=v;
  draw(); updateInfo();
}

/* ======= Animación (arreglada): toggle + loop controlado ======= */
function toggleAnim(btn){
  state.anim = !state.anim;
  btn.textContent = state.anim ? 'Pausar' : 'Animar';
  if(state.anim) tick();
}
function tick(){
  if(!state.anim) return;
  const step = Math.max(1, Math.round(state.nMax/120));
  setN(state.n >= state.nMax ? 1 : state.n + step);
  state.raf = requestAnimationFrame(tick);
}

/* ======= Dibujo del gráfico ======= */
function draw(){
  const cv=byId('chart'), g=cv.getContext('2d');
  const W=cv.width, H=cv.height;
  g.clearRect(0,0,W,H);
  const l=46, r=16, t=14, b=30, w=W-l-r, h=H-t-b;
  const nMax=state.nMax;
  const yMax=Math.max(logFact[nMax], logPow2[nMax]);
  const xOf = n => l + (n-1) * (w/(nMax-1));
  const yOf = val => t + (1 - val/yMax) * h;

  // grid
  g.strokeStyle=COLORS.grid; g.lineWidth=1; g.beginPath();
  for(let k=0;k<=5;k++){ const y=t+k*(h/5); g.moveTo(l,y); g.lineTo(W-r,y); } g.stroke();

  // axes
  g.strokeStyle=COLORS.axes; g.lineWidth=1.5; g.beginPath();
  g.moveTo(l,t); g.lineTo(l,H-b); g.lineTo(W-r,H-b); g.stroke();

  // labels
  g.fillStyle=COLORS.axisText; g.font='12px system-ui';
  g.fillText('n (1 … '+nMax+')', W-120, H-8);
  g.save(); g.translate(14, H/2); g.rotate(-Math.PI/2);
  g.fillText('valor (log₁₀)', 0, 0); g.restore();

  // log10(n!)
  g.strokeStyle=COLORS.curveA; g.lineWidth=2; g.beginPath();
  for(let n=1;n<=nMax;n++){ const x=xOf(n), y=yOf(logFact[n]); n===1?g.moveTo(x,y):g.lineTo(x,y); } g.stroke();

  // log10(2^n)
  g.strokeStyle=COLORS.curveB; g.lineWidth=2; g.beginPath();
  for(let n=1;n<=nMax;n++){ const x=xOf(n), y=yOf(logPow2[n]); n===1?g.moveTo(x,y):g.lineTo(x,y); } g.stroke();

  // pointer
  g.setLineDash([5,5]); g.strokeStyle=COLORS.pointer; g.lineWidth=1.5;
  const xn=xOf(state.n); g.beginPath(); g.moveTo(xn,t); g.lineTo(xn,H-b); g.stroke(); g.setLineDash([]);

  // marca del cruce n=4
  if(nMax>=4){
    const x4=xOf(4);
    g.strokeStyle=COLORS.cross; g.lineWidth=1; g.beginPath();
    g.moveTo(x4,t); g.lineTo(x4,H-b); g.stroke();
    g.fillStyle=COLORS.cross; g.fillText('corte n=4', x4-26, t+12);
  }

  // leyendas al final
  g.fillStyle=COLORS.curveA; g.fillText('log₁₀(n!)', xOf(nMax)-80, yOf(logFact[nMax])-6);
  g.fillStyle=COLORS.curveB; g.fillText('log₁₀(2ⁿ)', xOf(nMax)-80, yOf(logPow2[nMax])+14);
}

/* ======= Init ======= */
window.addEventListener('load', ()=>{
  setNmax(byId('nMax').value);
  setN(byId('n').value);
  updateInfo();
});
</script>
</body>
</html>
