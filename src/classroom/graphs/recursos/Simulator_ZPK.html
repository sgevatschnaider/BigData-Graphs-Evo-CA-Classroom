<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ZKP Demos — Ali Baba's Cave + Hash Commitment</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#0b1020; --bg2:#0f1a3a;
    --card:#141a32; --ink:#eaf0ff; --muted:#9aa3c7;
    --acc:#6cf4db; --acc2:#a98bff; --good:#66e39f; --bad:#ff6b6b; --warn:#ffd166;
    --line: rgba(255,255,255,.10);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif; color:var(--ink);
    background: radial-gradient(1200px 700px at 20% 10%, #101a3a 0%, transparent 55%),
                radial-gradient(1200px 700px at 80% 90%, #0f2a4a 0%, transparent 55%),
                linear-gradient(160deg,var(--bg1),var(--bg2));
  }
  .wrap{max-width:1200px; margin:0 auto; padding:28px;}
  header h1{margin:0 0 6px; font-size:28px; font-weight:800; letter-spacing:.3px}
  header p{margin:0; color:var(--muted)}
  .tabs{margin-top:18px; display:flex; gap:10px; flex-wrap:wrap}
  .tab-btn{
    cursor:pointer; padding:10px 14px; border-radius:12px;
    background:#0f1430; color:var(--ink); border:1px solid var(--line);
    font-weight:700; letter-spacing:.2px; transition:filter .15s
  }
  .tab-btn.active{background:linear-gradient(135deg,var(--acc),var(--acc2)); color:#081022; border-color:transparent; box-shadow:0 10px 24px rgba(108,244,219,.2)}
  .tab-panel{display:none; margin-top:16px}
  .tab-panel.active{display:block}
  .grid{display:grid; grid-template-columns: 420px 1fr; gap:24px}
  @media (max-width: 980px){ .grid{grid-template-columns:1fr} }
  .panel{
    background:linear-gradient(180deg, rgba(255,255,255,.04), transparent 60%), var(--card);
    border:1px solid var(--line); border-radius:16px; padding:18px 18px 14px; box-shadow:0 10px 30px rgba(0,0,0,.25);
  }
  .panel h2{margin:0 0 10px; font-size:16px; font-weight:800; letter-spacing:.2px}
  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  .pill{padding:10px 14px; border-radius:12px; border:1px solid var(--line); background:#0f1430; color:var(--ink); font-size:14px}
  .btn{
    cursor:pointer; border:none; padding:12px 16px; font-weight:800; letter-spacing:.3px;
    color:#0b1020; border-radius:12px; position:relative; overflow:hidden;
    background: linear-gradient(135deg, var(--acc), var(--acc2));
    box-shadow: 0 8px 22px rgba(108,244,219,.25), inset 0 0 0 1px rgba(0,0,0,.1);
    transition: transform .08s ease, filter .2s ease;
  }
  .btn:hover{filter:brightness(1.05)} .btn:active{transform:translateY(1px)}
  .btn.alt{background: linear-gradient(135deg, #5bd1ff, #8a9bff); color:#091022}
  .btn.ghost{background:transparent; color:var(--ink); border:1px solid var(--line)}
  .btn.copy{padding:8px 10px; font-size:12px; border-radius:10px}
  .toggle{display:inline-flex; align-items:center; gap:10px; padding:10px 12px; border-radius:12px; background:#0e1433; border:1px solid var(--line)}
  .toggle input{appearance:none; width:48px; height:26px; border-radius:999px; position:relative; background:#263057; outline:none; cursor:pointer; transition:background .2s}
  .toggle input::after{content:""; position:absolute; width:20px; height:20px; border-radius:50%; background:white; top:3px; left:3px; transition:all .2s}
  .toggle input:checked{background:linear-gradient(135deg,#45f2d2,#8a83ff)} .toggle input:checked::after{left:25px}
  .stat{display:grid; grid-template-columns: 1fr 1fr; gap:8px; margin-top:12px}
  .stat .box{background:#0f1430; border:1px solid var(--line); border-radius:12px; padding:12px}
  .stat .k{font-size:12px; color:var(--muted); margin-bottom:6px}
  .stat .v{font-size:18px; font-weight:800}
  .stat .v.good{color:var(--good)} .stat .v.bad{color:var(--bad)} .stat .v.warn{color:var(--warn)}
  .note{font-size:12px; color:var(--muted); margin-top:6px}
  .sep{height:1px; background:linear-gradient(90deg, transparent, rgba(255,255,255,.1), transparent); margin:12px 0}
  .legend{display:flex; gap:12px; font-size:12px; color:var(--muted); margin-top:10px}
  .chip{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; background:#0e1433; border:1px solid var(--line)}
  .dot{width:10px; height:10px; border-radius:50%}
  .dot.agent{background:linear-gradient(135deg,#6cf4db,#a98bff)} .dot.ok{background:var(--good)} .dot.fail{background:var(--bad)}

  /* --- SCENE TAB 1 --- */
  .scene{position:relative; height:480px; border-radius:16px; overflow:hidden;
    background: radial-gradient(600px 240px at 50% 100%, rgba(172,148,255,.18), transparent 70%),
                radial-gradient(1000px 540px at 50% 110%, rgba(108,244,219,.12), transparent 60%),
                linear-gradient(180deg,#0f1430,#0b1020 55%); border:1px solid var(--line);
  }
  .ground{position:absolute; left:0; right:0; bottom:0; height:160px; background: linear-gradient(0deg,#0c1128,transparent 70%); border-top:1px solid var(--line)}
  .cave{position:absolute; left:50%; transform:translateX(-50%); bottom:80px; width:560px; height:280px; border-radius:60% 60% 14px 14px / 70% 70% 14px 14px;
    background: radial-gradient(120px 60px at 50% 100%, rgba(0,0,0,.6), transparent 60%),
                linear-gradient(180deg,#121935,#0c1026 50%);
    box-shadow: inset 0 -30px 80px rgba(0,0,0,.5), inset 0 20px 50px rgba(255,255,255,.04);
    border:1px solid rgba(255,255,255,.04)
  }
  .tunnel{position:absolute; bottom:18px; width:44%; height:75%; background: #0a0f22; border:1px solid rgba(255,255,255,.05); border-radius:20px 20px 8px 8px; box-shadow: inset 0 -20px 40px rgba(0,0,0,.5)}
  .tunnel.left{left:4%} .tunnel.right{right:4%}
  .door{position:absolute; bottom:18px; width:120px; height:150px; background:#0b0f24; border:1px solid rgba(255,255,255,.15); border-radius:12px; display:flex; align-items:center; justify-content:center; font-weight:800; letter-spacing:.6px; color:#b9c3ff; text-shadow:0 0 8px rgba(169,139,255,.35)}
  .door.A{left:20%} .door.B{right:20%} .door span{opacity:.9} .door.flash{animation: flash .7s ease}
  @keyframes flash{0%{box-shadow:0 0 0 rgba(108,244,219,0)}50%{box-shadow:0 0 24px rgba(108,244,219,.7)}100%{box-shadow:0 0 0 rgba(108,244,219,0)}}
  .agent{--x:50%; --y:88%; position:absolute; width:22px; height:22px; border-radius:50%; background:linear-gradient(135deg,#6cf4db,#a98bff);
    box-shadow:0 0 12px rgba(169,139,255,.6), 0 0 30px rgba(108,244,219,.25); left:var(--x); top:var(--y); transform:translate(-50%,-50%);
    transition: left .9s ease, top .9s ease; border:1px solid rgba(255,255,255,.3)}
  .agent:after{content:""; position:absolute; width:10px; height:10px; border-radius:50%; background:rgba(255,255,255,.8); top:2px; right:2px; filter:blur(2px)}
  .label{position:absolute; padding:6px 10px; border-radius:10px; background:#0f1430cc; border:1px solid var(--line); font-size:12px; color:#c8d0ff; backdrop-filter: blur(6px)}
  .label.verif{left:50%; transform:translateX(-50%); top:12px}
  .label.challenge{left:50%; transform:translateX(-50%); top:42px; color:#ffe8a6}
  .label.round{right:12px; bottom:12px; color:#b0ffc8}

  /* --- TAB 2 FORM --- */
  .form-grid{display:grid; grid-template-columns:1fr 1fr; gap:18px}
  @media (max-width:980px){.form-grid{grid-template-columns:1fr}}
  .f{display:flex; flex-direction:column; gap:8px}
  .f label{font-size:12px; color:var(--muted)}
  .f input, .f textarea{
    width:100%; padding:12px 12px; border-radius:12px; border:1px solid var(--line); background:#0f1430; color:var(--ink);
    font-size:14px; outline:none;
  }
  .f textarea{min-height:86px; resize:vertical; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
  .help{font-size:12px; color:var(--muted)}
  .badge{display:inline-block; padding:6px 10px; border-radius:999px; font-size:12px; border:1px solid var(--line); background:#0f1430; color:#cbd3ff}
  .result{padding:10px 12px; border-radius:12px; border:1px dashed var(--line); background:#0a0f24; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12.5px}
  .ok{color:var(--good); font-weight:800}
  .fail{color:var(--bad); font-weight:800}
  .footnote{margin-top:12px; color:var(--muted); font-size:12px; text-align:center}
  .credit{margin:24px 0 6px; color:#93a0d7; font-size:12px; text-align:center}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Zero-Knowledge Proofs (ZKP) — Interactive Demos</h1>
      <p>Two ways to understand "proving without revealing": (1) <b>Ali Baba's Cave</b> and (2) <b>Hash Commitment (Commit–Reveal)</b>.</p>
    </header>

    <div class="tabs">
      <button class="tab-btn active" data-tab="t1">1) Ali Baba's Cave</button>
      <button class="tab-btn" data-tab="t2">2) Hash Commitment (Commit–Reveal)</button>
    </div>

    <!-- TAB 1: CAVE -->
    <section id="t1" class="tab-panel active">
      <div class="grid">
        <!-- CONTROLS PANEL -->
        <section class="panel">
          <h2>Ali Baba's Cave — Controls</h2>
          <div class="row" style="gap:12px; margin-bottom:8px">
            <label class="toggle">
              <input type="checkbox" id="knowsSecret" checked>
              <span>Prover knows the secret word</span>
            </label>
            <span class="pill">Random challenge: A or B</span>
          </div>

          <div class="row" style="gap:10px; margin:10px 0 6px">
            <button class="btn" id="btnRound">Play 1 round</button>
            <button class="btn alt" id="btnAuto5">Auto ×5</button>
            <button class="btn ghost" id="btnReset">Reset</button>
          </div>

          <div class="stat">
            <div class="box"><div class="k">Total Rounds</div><div class="v" id="statRounds">0</div></div>
            <div class="box"><div class="k">Successes</div><div class="v good" id="statHits">0</div></div>
            <div class="box"><div class="k">Failures</div><div class="v bad" id="statMiss">0</div></div>
            <div class="box"><div class="k">If secret is NOT known, prob. of cheating</div><div class="v warn" id="statCheat">—</div></div>
          </div>
          <div class="note">Prob. of cheating after k consecutive successes without secret: <b>(1/2)<sup>k</sup></b>. E.g.: 10 successes ≈ 0.0977%.</div>

          <div class="sep"></div>
          <h2>Log</h2>
          <div class="log" id="log"></div>
          <div class="footnote">Tip: Run <b>Auto ×5</b> multiple times with the secret disabled to visualize the exponential drop.</div>
        </section>

        <!-- SCENE -->
        <section class="scene panel" id="scene">
          <div class="label verif" id="lblVerif">Verifier waiting…</div>
          <div class="label challenge" id="lblChallenge">Challenge: —</div>
          <div class="label round" id="lblRound">Round #0</div>

          <div class="cave">
            <div class="tunnel left"></div>
            <div class="tunnel right"></div>
            <div class="door A"><span>DOOR A</span></div>
            <div class="door B"><span>DOOR B</span></div>
          </div>
          <div class="agent" id="agent"></div>
          <div class="ground"></div>

          <div class="legend" style="position:absolute; left:12px; bottom:12px">
            <span class="chip"><span class="dot agent"></span> Prover</span>
            <span class="chip"><span class="dot ok"></span> Success</span>
            <span class="chip"><span class="dot fail"></span> Failure</span>
          </div>
        </section>
      </div>
    </section>

    <!-- TAB 2: HASH COMMITMENT -->
    <section id="t2" class="tab-panel">
      <div class="grid">
        <!-- LEFT PANEL: CREATE COMMITMENT -->
        <section class="panel">
          <h2>Create Commitment (Commit)</h2>
          <p class="help">Generate a commitment <span class="badge">C = SHA-256(salt || ":" || secret)</span>. The commitment can be published; the secret cannot.</p>

          <div class="f">
            <label>Secret (will not be shown):</label>
            <input type="password" id="commitSecret" placeholder="Enter your word/password…">
          </div>

          <div class="row" style="margin:10px 0">
            <button class="btn" id="btnCommit">Create Commitment</button>
            <button class="btn ghost" id="btnClearCommit">Clear</button>
          </div>

          <div class="sep"></div>
          <div class="f">
            <label>Generated Salt (hex):</label>
            <div class="row" style="align-items:stretch">
              <input id="outSalt" readonly>
              <button class="btn copy" data-copy="#outSalt">Copy</button>
            </div>
          </div>

          <div class="f">
            <label>Commitment C (hex, SHA-256):</label>
            <div class="row" style="align-items:stretch">
              <textarea id="outCommit" readonly></textarea>
              <button class="btn copy" data-copy="#outCommit">Copy</button>
            </div>
          </div>

          <div class="note">The <b>salt</b> prevents dictionary/reuse attacks; publishing <b>salt</b> + <b>C</b> does not reveal the secret.</div>
        </section>

        <!-- RIGHT PANEL: VERIFY KNOWLEDGE -->
        <section class="panel">
          <h2>Verify Knowledge (Reveal without revealing the secret)</h2>
          <p class="help">The verifier only needs the commitment <b>C</b> and the <b>salt</b>. The prover enters their secret locally; the UI only shows <b>Success/Failure</b>.</p>

          <div class="form-grid" style="margin-top:6px">
            <div class="f">
              <label>Salt (hex):</label>
              <input id="inSalt" placeholder="Paste the salt…">
            </div>
            <div class="f">
              <label>Commitment C (hex, SHA-256):</label>
              <input id="inCommit" placeholder="Paste the commitment…">
            </div>
          </div>

          <div class="f" style="margin-top:6px">
            <label>Enter your secret (not printed):</label>
            <input type="password" id="proveSecret" placeholder="Enter the secret to prove you know it…">
          </div>

          <div class="row" style="margin:10px 0">
            <button class="btn alt" id="btnProve">Prove Knowledge</button>
            <button class="btn ghost" id="btnClearVerify">Clear</button>
          </div>

          <div class="result" id="verifyResult">Status: —</div>

          <div class="sep"></div>
          <h2>What's happening?</h2>
          <ul class="help" style="margin-top:6px">
            <li>First, you publish the <b>salt</b> and <b>C</b> (the commitment). No one knows the secret.</li>
            <li>To verify, you enter the secret on your device. The app calculates <b>H(salt || ":" || secret)</b> and compares it with <b>C</b>.</li>
            <li>The verifier only gets a <b>yes/no</b> (completeness/soundness) without learning the secret (<b>zero-knowledge at a practical UI level</b>).</li>
          </ul>
          <div class="note">Note: This models a simple hash commitment. In production, ZKPs allow for formal proofs without revealing inputs or re-running the computation in the clear.</div>
        </section>
      </div>
    </section>

    <div class="credit">Material created by Professor Sergio Gevatschnaider</div>
  </div>

<script>
/* ========= TABS ========= */
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(btn.dataset.tab).classList.add('active');
  });
});

/* ========= TAB 1: ALI BABA'S CAVE ========= */
(function(){
  const agent = document.getElementById('agent');
  if(!agent) return; // if not mounted (e.g., SSR), exit

  const lblVerif = document.getElementById('lblVerif');
  const lblChallenge = document.getElementById('lblChallenge');
  const lblRound = document.getElementById('lblRound');
  const knowsSecret = document.getElementById('knowsSecret');
  const btnRound = document.getElementById('btnRound');
  const btnAuto5 = document.getElementById('btnAuto5');
  const btnReset = document.getElementById('btnReset');
  const log = document.getElementById('log');

  const statRounds = document.getElementById('statRounds');
  const statHits   = document.getElementById('statHits');
  const statMiss   = document.getElementById('statMiss');
  const statCheat  = document.getElementById('statCheat');
  const doors = { A: document.querySelector('.door.A'), B: document.querySelector('.door.B') };

  let rounds=0, hits=0, miss=0, consecutiveProofs=0;

  const pos = {
    entryA: {x: '30%', y: '70%'},
    entryB: {x: '70%', y: '70%'},
    center: {x: '50%', y: '72%'},
    hide:   {x: '50%', y: '30%'},
    outA:   {x: '30%', y: '76%'},
    outB:   {x: '70%', y: '76%'}
  };

  function move(p, delay=0){
    return new Promise(res=>setTimeout(()=>{ agent.style.setProperty('--x', p.x); agent.style.setProperty('--y', p.y); setTimeout(res, 950); }, delay));
  }
  function fxFlash(door){ door.classList.add('flash'); setTimeout(()=>door.classList.remove('flash'), 700); }
  function randAB(){ return Math.random()<.5 ? 'A':'B'; }

  function updateStats(){
    statRounds.textContent = rounds;
    statHits.textContent = hits;
    statMiss.textContent = miss;
    if(!knowsSecret.checked){
      const p = Math.pow(0.5, consecutiveProofs);
      statCheat.textContent = consecutiveProofs===0 ? '—' : (p*100).toFixed(4)+'%';
    }else{
      statCheat.textContent = 'N/A (with secret)';
    }
  }
  function appendLog(text, ok=null){
    const color = ok===true ? ' style="color:#66e39f"' : ok===false ? ' style="color:#ff6b6b"' : '';
    log.innerHTML = `<div${color}>${text}</div>` + log.innerHTML;
  }

  async function playOneRound(){
    rounds++; lblRound.textContent = `Round #${rounds}`;
    const entered = randAB();
    const challenge = randAB();
    lblVerif.textContent = 'Verifier: Choose an exit!';
    lblChallenge.textContent = `Challenge: Exit through ${challenge}`;
    await move(entered==='A' ? pos.entryA : pos.entryB, 50);
    await move(pos.hide, 80);
    const canSwitch = knowsSecret.checked;
    const exitDoor = canSwitch ? challenge : entered;
    await move(exitDoor==='A' ? pos.outA : pos.outB, 120);
    const success = (exitDoor === challenge);
    fxFlash(doors[challenge]);
    if(success){ hits++; consecutiveProofs++; } else { miss++; consecutiveProofs = 0; }
    appendLog(`<b>Round ${rounds}:</b> Entered through <b>${entered}</b>, challenge <b>${challenge}</b> → ` + (success ? '<b>SUCCESS</b> ✅' : '<b>FAILURE</b> ❌'), success);
    updateStats();
    lblVerif.textContent = success ? 'Verifier: I accept the proof ✅' : 'Verifier: I reject the proof ❌';
  }

  function autoN(n){
    let i=0;
    const step=async()=>{
      if(i++>=n) return;
      btnRound.disabled = btnAuto5.disabled = true;
      await playOneRound();
      setTimeout(()=>step(), 250);
    };
    step();
    setTimeout(()=>{ btnRound.disabled = btnAuto5.disabled = false; }, n*1300+300);
  }
  function resetAll(){
    rounds=hits=miss=consecutiveProofs=0;
    log.innerHTML='';
    updateStats();
    lblVerif.textContent = 'Verifier waiting…';
    lblChallenge.textContent = 'Challenge: —';
    lblRound.textContent = 'Round #0';
    move(pos.center, 0);
  }

  btnRound?.addEventListener('click', playOneRound);
  btnAuto5?.addEventListener('click', ()=>autoN(5));
  btnReset?.addEventListener('click', resetAll);
  knowsSecret?.addEventListener('change', ()=>{
    consecutiveProofs=0; updateStats();
    appendLog(`<i>Mode changed:</i> ${knowsSecret.checked? 'with' : 'without'} the secret.`);
  });

  resetAll();
})();

/* ========= TAB 2: HASH COMMITMENT ========= */
(function(){
  // helpers
  const q = sel => document.querySelector(sel);
  const qi = id => document.getElementById(id);

  const commitSecret = qi('commitSecret');
  const outSalt = qi('outSalt');
  const outCommit = qi('outCommit');
  const btnCommit = qi('btnCommit');
  const btnClearCommit = qi('btnClearCommit');

  const inSalt = qi('inSalt');
  const inCommit = qi('inCommit');
  const proveSecret = qi('proveSecret');
  const verifyResult = qi('verifyResult');
  const btnProve = qi('btnProve');
  const btnClearVerify = qi('btnClearVerify');

  // generate random salt (16 bytes -> hex)
  function randomSaltHex(len=16){
    const b = new Uint8Array(len);
    crypto.getRandomValues(b);
    return Array.from(b).map(x=>x.toString(16).padStart(2,'0')).join('');
  }
  async function sha256Hex(str){
    const enc = new TextEncoder().encode(str);
    const hashBuffer = await crypto.subtle.digest('SHA-256', enc);
    const view = new Uint8Array(hashBuffer);
    return Array.from(view).map(x=>x.toString(16).padStart(2,'0')).join('');
  }

  function copyToClipboard(sel){
    const el = q(sel);
    if(!el) return;
    const val = el.value || el.textContent || '';
    navigator.clipboard.writeText(val).then(()=>{
      const btn = document.querySelector(`[data-copy="${sel}"]`);
      if(btn){
        const old = btn.textContent;
        btn.textContent = 'Copied ✔';
        setTimeout(()=>btn.textContent = old, 1000);
      }
    });
  }

  document.querySelectorAll('.btn.copy').forEach(b=>{
    b.addEventListener('click', ()=>copyToClipboard(b.dataset.copy));
  });

  btnCommit?.addEventListener('click', async ()=>{
    const secret = commitSecret.value ?? '';
    if(!secret){ alert('Please enter a secret to commit.'); return; }
    const salt = randomSaltHex(16);
    const C = await sha256Hex(`${salt}:${secret}`);
    outSalt.value = salt;
    outCommit.value = C;
  });

  btnClearCommit?.addEventListener('click', ()=>{
    commitSecret.value = ''; outSalt.value = ''; outCommit.value = '';
  });

  btnProve?.addEventListener('click', async ()=>{
    const salt = (inSalt.value||'').trim();
    const C = (inCommit.value||'').trim().toLowerCase();
    const secret = proveSecret.value ?? '';
    if(!salt || !C){ alert('Please provide the Salt and Commitment C.'); return; }
    if(!secret){ alert('Please enter the secret to prove your knowledge.'); return; }
    const calc = (await sha256Hex(`${salt}:${secret}`)).toLowerCase();
    const ok = (calc === C);
    verifyResult.innerHTML = ok ? 'Status: <span class="ok">SUCCESS — You know the secret</span> ✅' :
                                 'Status: <span class="fail">FAILURE — The secret does not match</span> ❌';
    // For privacy, we don't print the secret or the calculated hash; only yes/no.
  });

  btnClearVerify?.addEventListener('click', ()=>{
    inSalt.value = ''; inCommit.value = ''; proveSecret.value = '';
    verifyResult.textContent = 'Status: —';
  });
})();
</script>
</body>
</html>