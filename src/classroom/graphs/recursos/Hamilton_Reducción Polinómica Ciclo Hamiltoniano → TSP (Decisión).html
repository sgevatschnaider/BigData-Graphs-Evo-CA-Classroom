<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reducción Visual: Ciclo Hamiltoniano a TSP</title>
  <!-- Inclusión de la librería vis.js para la visualización de grafos -->
  <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      padding: 20px; 
      background: #f9f9f9; 
      color: #333;
    }
    h2 { 
      text-align: center;
      color: #2c3e50; 
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .graph-section {
      display: flex;
      justify-content: space-around;
      align-items: flex-start;
      gap: 20px;
      margin-top: 20px;
    }
    .graph-container {
      width: 48%;
      height: 400px;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      background: white;
    }
    .description {
      padding: 15px;
      background-color: #ecf0f1;
      border-radius: 8px;
    }
    .result {
      font-size: 1.2em;
      margin-top: 25px;
      padding: 15px;
      text-align: center;
      border-radius: 8px;
    }
    button { 
      display: block;
      margin: 20px auto;
      padding: 12px 25px;
      font-size: 16px; 
      cursor: pointer;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #2980b9;
    }
  </style>
</head>
<body>

<div class="container">
  <h2>Reducción Polinómica: Ciclo Hamiltoniano → TSP (Decisión)</h2>

  <div class="description">
    <p>Se demuestra cómo un grafo G se puede transformar en una instancia para el TSP. El objetivo es determinar si G tiene un <strong>Ciclo Hamiltoniano</strong> (un camino que visita cada nodo exactamente una vez y vuelve al inicio).</p>
    <ul>
      <li><strong>Grafo Original (G):</strong> El problema de entrada.</li>
      <li><strong>Grafo TSP Completo:</strong> Se crea un grafo completo. Las aristas que <strong>existían</strong> en G tienen <strong>peso 1</strong> (verde). Las que <strong>no existían</strong> tienen <strong>peso 2</strong> (rojo).</li>
      <li><strong>La Reducción:</strong> G tiene un ciclo hamiltoniano <strong>si y solo si</strong> existe un tour en el grafo completo con un costo total igual al número de nodos (n).</li>
    </ul>
  </div>

  <div class="graph-section">
    <div id="original-graph" class="graph-container"></div>
    <div id="tsp-graph" class="graph-container"></div>
  </div>

  <button onclick="checkAndHighlight()">¿Existe un Tour de coste ≤ n?</button>
  <div id="tsp-result" class="result"></div>
</div>

<script>
  // --- Definición del Grafo de Entrada ---
  const nodeIds = ['A', 'B', 'C', 'D'];
  // Un ciclo hamiltoniano claro: A -> B -> C -> D -> A
  const originalEdges = [
    { from: 'A', to: 'B' },
    { from: 'B', to: 'C' },
    { from: 'C', to: 'D' },
    { from: 'D', to: 'A' },
    // Arista adicional que no es parte del ciclo
    { from: 'A', to: 'C' }
  ];
  
  const n = nodeIds.length;
  // El ciclo que queremos encontrar y resaltar
  const hamiltonianCycle = [
      { from: 'A', to: 'B' }, { from: 'B', to: 'C' }, 
      { from: 'C', to: 'D' }, { from: 'D', to: 'A' }
  ];

  const nodes = new vis.DataSet(nodeIds.map(id => ({ id: id, label: id })));
  let originalNetwork, tspNetwork;

  // --- Funciones de Visualización ---

  function drawOriginalGraph() {
    const data = {
      nodes: nodes,
      edges: new vis.DataSet(originalEdges.map(e => ({...e, arrows: 'to'})))
    };
    const options = {
      nodes: { font: { size: 18 } },
      edges: { color: '#3498db', width: 2 },
      physics: { stabilization: true }
    };
    const container = document.getElementById('original-graph');
    originalNetwork = new vis.Network(container, data, options);
  }

  function drawTSPGraph() {
    const tspEdges = [];
    const existingEdgesSet = new Set(originalEdges.map(e => `${e.from}-${e.to}`).concat(originalEdges.map(e => `${e.to}-${e.from}`)));

    for (let i = 0; i < nodeIds.length; i++) {
      for (let j = i + 1; j < nodeIds.length; j++) {
        const u = nodeIds[i];
        const v = nodeIds[j];
        const existsInG = existingEdgesSet.has(`${u}-${v}`);
        
        const weight = existsInG ? 1 : 2;
        const color = existsInG ? 'green' : 'red';
        const dashes = !existsInG; // Línea discontinua para aristas nuevas

        tspEdges.push({
          from: u,
          to: v,
          label: `w=${weight}`,
          color: { color: color, highlight: '#ff0000' },
          font: { align: 'middle' },
          dashes: dashes
        });
      }
    }

    const data = { nodes: nodes, edges: new vis.DataSet(tspEdges) };
    const options = {
      nodes: { font: { size: 18 } },
      edges: { width: 2 },
      physics: { stabilization: true }
    };
    const container = document.getElementById('tsp-graph');
    tspNetwork = new vis.Network(container, data, options);
  }

  function checkAndHighlight() {
      const resultDiv = document.getElementById('tsp-result');
      
      // Resaltar el ciclo hamiltoniano en ambos grafos
      const highlightEdges = (network, cycle) => {
          const edgeIds = network.body.data.edges.getIds();
          network.body.data.edges.update(edgeIds.map(id => ({id, color: {opacity: 0.3}, width: 1}))); // Atenuar todas
          
          const cycleEdgeIds = [];
          const cycleSet = new Set(cycle.map(e => `${e.from}-${e.to}`).concat(cycle.map(e => `${e.to}-${e.from}`)));

          network.body.data.edges.forEach(edge => {
              if (cycleSet.has(`${edge.from}-${edge.to}`)) {
                  cycleEdgeIds.push(edge.id);
              }
          });

          network.body.data.edges.update(cycleEdgeIds.map(id => ({
            id: id, 
            color: { color: '#ff8800', opacity: 1 }, 
            width: 4,
            dashes: false
          })));
      };
      
      highlightEdges(originalNetwork, hamiltonianCycle);
      highlightEdges(tspNetwork, hamiltonianCycle);

      resultDiv.innerHTML = `
        <strong style="color:green;">
          ✅ Sí: Se encontró un tour de costo total ${n}.
        </strong><br>
        Esto es posible porque todas las aristas del ciclo hamiltoniano tienen peso 1 (1 × ${n} = ${n}).<br>
        Esto confirma que el grafo original G tiene un ciclo hamiltoniano.
      `;
      resultDiv.style.backgroundColor = '#dff0d8';
      resultDiv.style.border = '1px solid #d6e9c6';
  }

  // --- Inicialización ---
  document.addEventListener('DOMContentLoaded', () => {
    drawOriginalGraph();
    drawTSPGraph();
  });

</script>

</body>
</html>
