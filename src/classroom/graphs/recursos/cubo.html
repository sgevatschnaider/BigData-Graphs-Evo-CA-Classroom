<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cayley del Cubo — Rotaciones (S₄)</title>
<style>
  :root{
    --bg1:#0f1022; --bg2:#1a0f2e; --ink:#e9eaf5;
    --accent:#7cf7ff; --accent2:#ff7a7a;
    --panel:#ffffff0f; --panel-border:#ffffff22;
    --glowA: 0 0 14px #ff4d4d, 0 0 32px #ff4d4d44;
    --glowB: 0 0 14px #58c6ff, 0 0 32px #58c6ff44;
    --shadow: 0 10px 40px #0008;
  }
  html,body{height:100%; margin:0; background: radial-gradient(1200px 800px at 15% 10%, #1c1f45 0%, var(--bg1) 40%, var(--bg2) 100%);
    color:var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;}
  .wrap{display:grid; grid-template-columns: 340px 1fr; gap:14px; height:100%; padding:16px;}
  .panel{
    backdrop-filter: blur(10px) saturate(120%);
    -webkit-backdrop-filter: blur(10px) saturate(120%);
    background: var(--panel);
    border:1px solid var(--panel-border);
    border-radius:16px; padding:16px; box-shadow: var(--shadow);
  }
  h1{font-size:20px; margin:0 0 8px 0; letter-spacing:.5px}
  p,small{color:#d7d9efbb; line-height:1.35}
  .legend{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:6px}
  .badge{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; border:1px solid var(--panel-border); background:#ffffff08}
  .dot{width:10px; height:10px; border-radius:50%}
  .dot.a{background:#ff5d5d; box-shadow: var(--glowA)}
  .dot.b{background:#5fc8ff; box-shadow: var(--glowB)}
  .controls{display:grid; gap:10px; margin-top:10px}
  .row{display:flex; gap:8px; flex-wrap:wrap}
  button, .toggle{
    background:#ffffff12; color:var(--ink); border:1px solid var(--panel-border);
    padding:8px 12px; border-radius:10px; cursor:pointer; transition: .2s ease;
    font-weight:600; letter-spacing:.2px
  }
  button:hover{transform: translateY(-1px); background:#ffffff1e}
  button:active{transform: translateY(0)}
  .toggle{display:flex; align-items:center; gap:8px}
  input[type="checkbox"]{accent-color:#8bf}
  #info{font-variant-numeric: tabular-nums; margin-top:4px}

  /* Canvas area (SVG) */
  .stage{position:relative}
  svg{width:100%; height:100%; min-height: calc(100vh - 32px); border-radius:16px; background: #0b0e22; box-shadow: var(--shadow)}
  .node{cursor:pointer}
  .node circle{fill:url(#nodeGrad); stroke:#ffffff33; stroke-width:1.2}
  .node:hover circle{stroke:#fff9; filter: drop-shadow(0 0 6px #fff6)}
  .node text{font-size:10px; text-anchor:middle; dominant-baseline:central; pointer-events:none}
  .labelWord{font-size:8px; opacity:.7}
  .edge{fill:none; stroke-linecap:round; stroke-opacity:.9}
  .edge.a{stroke:#ff5d5d; filter: drop-shadow(var(--glowA));}
  .edge.b{stroke:#5fc8ff; filter: drop-shadow(var(--glowB));}
  .edge.hidden{opacity:.06}
  .node.active circle{stroke:#ffd166; stroke-width:2}
  .halo{fill:none; stroke:#ffd166; stroke-width:6; opacity:0; transition:.25s}
  .node.active + .halo{opacity:.25}
  .tooltip{
    position:absolute; pointer-events:none; padding:8px 10px; background:#0b0e22; border:1px solid #ffffff2a;
    border-radius:10px; font-size:12px; transform: translate(-50%, -140%);
    white-space:nowrap; box-shadow: var(--shadow); display:none
  }
  .credit{position:absolute; left:20px; bottom:14px; font-size:12px; opacity:.7}
  .kbd{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
       background:#00000044; padding:2px 6px; border-radius:6px; border:1px solid #ffffff22}
</style>
</head>
<body>
<div class="wrap">
  <aside class="panel">
    <h1>Gráfica de Cayley — Rotaciones del Cubo <span style="opacity:.7">(S₄)</span></h1>
    <p>
      Generadores: <b>a</b> = rotación 90° (ciclo (1 2 3 4)), <b>b</b> = rotación 120° (ciclo (2 3 4)).
      Aristas muestran multiplicación <em>a la derecha</em>: <span class="kbd">g → g·a</span> (rojo) y <span class="kbd">g → g·b</span> (azul).
    </p>
    <div class="legend">
      <span class="badge"><span class="dot a"></span> aristas ·a</span>
      <span class="badge"><span class="dot b"></span> aristas ·b</span>
      <span class="badge">nodos: permutación + palabra mínima</span>
    </div>

    <div class="controls">
      <div class="row">
        <button id="btnA">·a</button>
        <button id="btnAi">·a⁻¹</button>
        <button id="btnB">·b</button>
        <button id="btnBi">·b⁻¹</button>
        <button id="btnReset">Reset</button>
      </div>
      <div class="row">
        <button id="btnPlayA">Animar a</button>
        <button id="btnPlayB">Animar b</button>
        <button id="btnStop">Parar</button>
      </div>
      <div class="row">
        <label class="toggle"><input type="checkbox" id="chkA" checked/> mostrar aristas ·a</label>
        <label class="toggle"><input type="checkbox" id="chkB" checked/> mostrar aristas ·b</label>
        <label class="toggle"><input type="checkbox" id="chkLabels" checked/> etiquetas</label>
      </div>
      <div id="info">
        <small>Elemento actual: <span id="curName">e</span> — ciclo: <span id="curCycle">( )</span></small><br/>
        <small>Palabra: <span id="curWord">ε</span></small>
      </div>
      <p style="margin-top:8px"><small>
        Consejo: haz <b>clic</b> en un nodo para seleccionarlo; usa los botones para “caminar” por la gráfica y visualizar productos.
      </small></p>
    </div>
  </aside>

  <main class="stage">
    <svg id="svg" viewBox="-520 -360 1040 720" preserveAspectRatio="xMidYMid meet" aria-label="Cayley graph">
      <defs>
        <radialGradient id="nodeGrad" cx="40%" cy="35%">
          <stop offset="0%" stop-color="#ffffff" stop-opacity="0.9"/>
          <stop offset="100%" stop-color="#c7d2ff" stop-opacity="0.12"/>
        </radialGradient>
        <marker id="arrowA" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="#ff5d5d"/>
        </marker>
        <marker id="arrowB" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="#5fc8ff"/>
        </marker>
        <filter id="softGlow">
          <feGaussianBlur stdDeviation="18" result="blur"/>
          <feMerge>
            <feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>
      <!-- edges go here -->
      <g id="edgesA"></g>
      <g id="edgesB"></g>
      <!-- nodes go here -->
      <g id="nodes"></g>
    </svg>
    <div class="tooltip" id="tip"></div>
    <div class="credit">Hecho con ♥ para mostrar la belleza de las simetrías del cubo.</div>
  </main>
</div>

<script>
/* ===================== utilidades de permutaciones ===================== */
function compose(p, q){ // p ∘ q (aplica q y luego p)
  const r = [0,0,0,0,0];
  for (let i=1;i<=4;i++) r[i] = p[q[i]];
  return r;
}
function inv(p){
  const r = [0,0,0,0,0];
  for (let i=1;i<=4;i++) r[p[i]] = i;
  return r;
}
function eq(p,q){ for(let i=1;i<=4;i++) if(p[i]!==q[i]) return false; return true; }
function key(p){ return p.slice(1).join(''); }
function cycleNotation(p){
  const seen = [false,false,false,false,false];
  const cycles = [];
  for(let i=1;i<=4;i++){
    if(!seen[i] && p[i]!==i){
      let cyc = [i]; seen[i]=true; let j=p[i];
      while(j!==i){ cyc.push(j); seen[j]=true; j=p[j]; }
      cycles.push('(' + cyc.join(' ') + ')');
    }
  }
  return cycles.length? cycles.join('') : '( )';
}

/* ===================== grupo S4 generado por a, b ===================== */
// Generadores del grupo de rotaciones del cubo (acción sobre 4 diagonales)
const e  = [0,1,2,3,4];              // identidad
const a  = [0,2,3,4,1];              // (1 2 3 4) — orden 4
const b  = [0,1,3,4,2];              // (2 3 4)   — orden 3
const ai = inv(a), bi = inv(b);

function buildGroup(){
  const gens = [a,b];
  const data = {};
  data[key(e)] = {perm:e, word:'ε'};
  let changed=true;
  while(changed){
    changed=false;
    for(const k in data){
      const g = data[k].perm;
      for(const [sym,gen] of [['a',a],['b',b]]){
        const h = compose(gen, g); // g · gen  (multiplicación a la derecha)
        const hk = key(h);
        if(!data[hk]){
          data[hk] = {perm:h, word: data[k].word==='ε'? sym : data[k].word + sym};
          changed=true;
        }
      }
    }
    // stop guard (debería terminar con 24 elementos)
    if(Object.keys(data).length>24) break;
  }
  return Object.values(data);
}

const elements = buildGroup(); // 24 elementos
elements.sort((A,B)=> key(A.perm).localeCompare(key(B.perm))); // orden estable

/* ===================== layout circular estético ===================== */
const N = elements.length;
const radius = 270;
for(let i=0;i<N;i++){
  const t = (i/N) * 2*Math.PI;
  const r = radius*(0.82 + 0.18*Math.sin(3*t)); // ligera ondulación estética
  elements[i].x = r * Math.cos(t);
  elements[i].y = r * Math.sin(t);
}

/* ===================== preparar SVG ===================== */
const svg = document.getElementById('svg');
const gNodes = document.getElementById('nodes');
const gEdgesA = document.getElementById('edgesA');
const gEdgesB = document.getElementById('edgesB');
const tip = document.getElementById('tip');

function edgePath(x1,y1,x2,y2,curv=0.16){
  // curva suave (cúbica) para separar visualmente aristas
  const dx = x2-x1, dy=y2-y1, mx=(x1+x2)/2, my=(y1+y2)/2;
  const nx = -dy, ny = dx;
  const cx = mx + nx*curv, cy = my + ny*curv;
  return `M ${x1} ${y1} Q ${cx} ${cy} ${x2} ${y2}`;
}

function drawEdges(){
  const make = (group, color, markerId, gen)=>{
    group.innerHTML = '';
    for(const el of elements){
      const h = compose(gen, el.perm);
      const tgt = elements.find(e=>eq(e.perm,h));
      const path = document.createElementNS('http://www.w3.org/2000/svg','path');
      path.setAttribute('class', `edge ${color}`);
      path.setAttribute('marker-end', `url(#${markerId})`);
      path.setAttribute('stroke-width', 2.2);
      path.setAttribute('d', edgePath(el.x, el.y, tgt.x, tgt.y));
      group.appendChild(path);
    }
  };
  make(gEdgesA, 'a', 'arrowA', a);
  make(gEdgesB, 'b', 'arrowB', b);
}

function drawNodes(){
  gNodes.innerHTML = '';
  for(const el of elements){
    const g = document.createElementNS('http://www.w3.org/2000/svg','g');
    g.setAttribute('class','node');
    g.setAttribute('transform', `translate(${el.x},${el.y})`);
    g.addEventListener('mouseenter', ev => {
      tip.style.display='block';
      tip.style.left = (ev.clientX)+'px';
      tip.style.top  = (ev.clientY)+'px';
      tip.innerHTML = `<b>${cycleNotation(el.perm)}</b><br><small>palabra: ${el.word}</small>`;
    });
    g.addEventListener('mouseleave', ()=> tip.style.display='none');
    g.addEventListener('click', ()=> select(el));

    const circle = document.createElementNS('http://www.w3.org/2000/svg','circle');
    circle.setAttribute('r', 18);

    const text = document.createElementNS('http://www.w3.org/2000/svg','text');
    text.setAttribute('y', -1);
    text.textContent = cycleNotation(el.perm);

    const word = document.createElementNS('http://www.w3.org/2000/svg','text');
    word.setAttribute('y', 12);
    word.setAttribute('class','labelWord');
    word.textContent = el.word;

    const halo = document.createElementNS('http://www.w3.org/2000/svg','circle');
    halo.setAttribute('class','halo');
    halo.setAttribute('r', 26);

    g.appendChild(circle);
    g.appendChild(text);
    g.appendChild(word);
    gNodes.appendChild(g);
    gNodes.appendChild(halo);
    el.g = g; el.halo = halo;
  }
}

drawEdges(); drawNodes();

/* ===================== interacción ===================== */
const curName = document.getElementById('curName');
const curCycle = document.getElementById('curCycle');
const curWord = document.getElementById('curWord');
let current = elements.find(el => eq(el.perm,e));
select(current);

function select(el){
  if(current){ current.g.classList.remove('active'); }
  current = el; current.g.classList.add('active');
  curName.textContent = key(el.perm) === '1234' ? 'e' : el.word;
  curCycle.textContent = cycleNotation(el.perm);
  curWord.textContent  = el.word;
}

function findByPerm(p){
  return elements.find(el => eq(el.perm,p));
}
function step(gen, sym){
  const h = compose(gen, current.perm); // current · gen
  const el = findByPerm(h);
  if(el) select(el);
}

/* botones */
const btnA  = document.getElementById('btnA');
const btnAi = document.getElementById('btnAi');
const btnB  = document.getElementById('btnB');
const btnBi = document.getElementById('btnBi');
const btnReset = document.getElementById('btnReset');

btnA.onclick  = ()=> step(a,'a');
btnAi.onclick = ()=> step(ai,'a⁻¹');
btnB.onclick  = ()=> step(b,'b');
btnBi.onclick = ()=> step(bi,'b⁻¹');
btnReset.onclick = ()=> select(elements.find(el => eq(el.perm,e)));

/* toggles */
const chkA = document.getElementById('chkA');
const chkB = document.getElementById('chkB');
const chkLabels = document.getElementById('chkLabels');
chkA.onchange = ()=> [...gEdgesA.children].forEach(p=> p.classList.toggle('hidden', !chkA.checked));
chkB.onchange = ()=> [...gEdgesB.children].forEach(p=> p.classList.toggle('hidden', !chkB.checked));
chkLabels.onchange = ()=>{
  document.querySelectorAll('.labelWord, .node text').forEach(t=>{
    t.style.display = chkLabels.checked ? 'block' : 'none';
  });
};

/* animación */
let timer=null;
const btnPlayA = document.getElementById('btnPlayA');
const btnPlayB = document.getElementById('btnPlayB');
const btnStop  = document.getElementById('btnStop');
btnPlayA.onclick = ()=> startAnim(a);
btnPlayB.onclick = ()=> startAnim(b);
btnStop.onclick = stopAnim;

function startAnim(gen){
  stopAnim();
  timer = setInterval(()=> step(gen,''), 600);
}
function stopAnim(){ if(timer){ clearInterval(timer); timer=null; } }

/* accesibilidad: teclas rápidas */
window.addEventListener('keydown', (ev)=>{
  if(ev.key==='a') btnA.click();
  else if(ev.key==='z') btnAi.click();
  else if(ev.key==='b') btnB.click();
  else if(ev.key==='n') btnBi.click();
  else if(ev.key==='r') btnReset.click();
});

/* pulso leve de brillo para el nodo activo */
setInterval(()=>{
  if(!current) return;
  current.halo.style.opacity = current.halo.style.opacity==='0.25' ? '0.12' : '0.25';
}, 800);
</script>
</body>
</html>
