<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>C√≠rculo Virtuoso de IA en China - Visualizaci√≥n Ampliada</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --card-bg: rgba(255, 255, 255, 0.85);
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --accent-color: #3b82f6;
            --border-color: rgba(0, 0, 0, 0.1);
            --shadow-color: rgba(0, 0, 0, 0.1);
            --transition-speed: 0.4s;
            --link-colors: #7c3aed, #22c55e, #f59e0b, #67e8f9;
        }

        body.dark-theme {
            --bg-color: #0b0f17;
            --card-bg: rgba(10, 14, 22, 0.75);
            --text-primary: #e8eef7;
            --text-secondary: #a9b7d0;
            --accent-color: #67e8f9;
            --border-color: rgba(255, 255, 255, 0.1);
            --shadow-color: rgba(0, 0, 0, 0.35);
        }

        * { box-sizing: border-box; }
        html, body { height: 100%; margin: 0; overflow: hidden; }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: background-color var(--transition-speed) ease;
        }
        body.dark-theme { background-image: radial-gradient(1200px 800px at 50% -10%, #111827 0%, #0b0f17 50%); }

        header {
            text-align: center;
            padding: 20px 16px 8px;
            width: min(1200px, 96vw);
            flex-shrink: 0;
        }
        h1 {
            font-size: clamp(1.4rem, 3vw, 2rem);
            margin: 0 0 8px 0;
        }
        .sub {
            color: var(--text-secondary);
            font-size: .95rem;
        }

        .wrap {
            width: min(1200px, 98vw);
            flex-grow: 1; /* Ocupa el espacio restante */
            position: relative;
            margin: 10px auto;
            border-radius: 24px;
            box-shadow: 0 20px 50px var(--shadow-color);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        canvas, svg {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            display: block;
        }

        .node {
            position: absolute;
            width: clamp(180px, 18vw, 220px);
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 18px;
            padding: 14px;
            box-shadow: 0 10px 30px var(--shadow-color);
            transform: translate(-50%, -50%);
            transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease, background-color var(--transition-speed) ease;
        }
        .node:hover {
            box-shadow: 0 16px 40px var(--shadow-color);
            border-color: var(--accent-color);
        }
        .node h3 { margin: 0 0 6px 0; font-size: 1rem; color: var(--text-primary); }
        .node p { margin: 0; color: var(--text-secondary); font-size: .85rem; line-height: 1.45; }
        .badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 999px;
            margin-bottom: 8px;
            font-size: .75rem;
            font-weight: 600;
            color: white;
        }

        .panel {
            width: min(1100px, 96vw);
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            align-items: center;
            padding: 12px 8px 10px;
            flex-shrink: 0;
        }
        .btn {
            appearance: none;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            background: var(--card-bg);
            padding: 10px 16px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .btn:hover { border-color: var(--accent-color); color: var(--accent-color); }
        .btn.tog[data-state="playing"] { border-color: rgba(34, 197, 94, .6); background: rgba(34, 197, 94, .15); }
        .btn.tog[data-state="paused"] { border-color: rgba(245, 158, 11, .6); background: rgba(245, 158, 11, .12); }

        .range { display: flex; align-items: center; gap: 10px; font-size: .9rem; color: var(--text-secondary); }
        input[type="range"] { width: 180px; }

        footer {
            padding: 10px;
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-secondary);
            opacity: 0.8;
            flex-shrink: 0;
        }

        .theme-toggle-button {
            position: fixed;
            top: 20px; right: 20px; z-index: 1001; width: 45px; height: 45px;
            border-radius: 50%; border: 1px solid var(--border-color);
            background-color: var(--card-bg); color: var(--text-primary);
            font-size: 1.4em; cursor: pointer; box-shadow: 0 4px 15px var(--shadow-color);
            display: flex; justify-content: center; align-items: center; transition: all 0.3s ease;
        }
        .theme-toggle-button:hover { transform: scale(1.1) rotate(15deg); }

        @media (max-width: 820px) {
            body { overflow: auto; height: auto; }
            .wrap { aspect-ratio: 1; min-height: 500px; }
        }
    </style>
</head>
<body class="dark-theme">
    <button id="theme-toggle" class="theme-toggle-button">‚òÄÔ∏è</button>
    <header>
        <h1>C√≠rculo Virtuoso de IA en China</h1>
        <div class="sub">Talento ‚Üí Universidades ‚Üí Empresas ‚Üí Estado Catalizador ‚Üí <strong>M√°s Talento</strong></div>
    </header>

    <div class="wrap" id="stage">
        <canvas id="particlesCanvas"></canvas>
        <svg id="linksSVG" preserveAspectRatio="none"></svg>

        <div class="node" id="talent">
            <div class="badge">Profesionales J√≥venes</div>
            <h3>Talento y Educaci√≥n</h3>
            <p>Formaci√≥n masiva en STEM y flujo constante de graduados con foco en IA aplicada.</p>
        </div>
        <div class="node" id="universities">
            <div class="badge">Universidades & I+D</div>
            <h3>Investigaci√≥n de Vanguardia</h3>
            <p>Transforman ciencia en publicaciones, modelos y est√°ndares globales.</p>
        </div>
        <div class="node" id="companies">
            <div class="badge">Empresas</div>
            <h3>Del Paper al Producto</h3>
            <p>Absorben conocimiento para crear soluciones, escalar y exportar. Retroalimentan con datos y capital.</p>
        </div>
        <div class="node" id="state">
            <div class="badge">Estado Catalizador</div>
            <h3>Coordinaci√≥n y Escala</h3>
            <p>Financia √°reas estrat√©gicas, integra esfuerzos y acelera la adopci√≥n de infraestructura.</p>
        </div>
    </div>

    <div class="panel">
        <button class="btn tog" id="toggle" data-state="playing">Pausar</button>
        <div class="range">
            <span>Velocidad</span>
            <input id="speed" type="range" min="0.25" max="3" step="0.05" value="1"/>
        </div>
        <button class="btn" id="pulse">Impulso</button>
    </div>

    <footer>
        Material elaborado por el profesor Sergio Gevatschnaider
    </footer>

<script>
(function(){
    // --- L√ìGICA DE CAMBIO DE TEMA ---
    const themeToggleButton = document.getElementById('theme-toggle');
    const body = document.body;
    themeToggleButton.addEventListener('click', () => {
        body.classList.toggle('dark-theme');
        const isDarkMode = body.classList.contains('dark-theme');
        themeToggleButton.textContent = isDarkMode ? '‚òÄÔ∏è' : 'üåô';
        localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
    });
    document.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('theme') || 'dark';
        if (savedTheme === 'dark') {
            body.classList.add('dark-theme');
            themeToggleButton.textContent = '‚òÄÔ∏è';
        } else {
            body.classList.remove('dark-theme');
            themeToggleButton.textContent = 'üåô';
        }
    });

    // --- L√ìGICA DE LA VISUALIZACI√ìN ---
    const stage = document.getElementById('stage');
    const canvas = document.getElementById('particlesCanvas');
    const ctx = canvas.getContext('2d');
    const svg = document.getElementById('linksSVG');
    const toggle = document.getElementById('toggle');
    const speedEl = document.getElementById('speed');
    const pulseBtn = document.getElementById('pulse');

    const nodes = [
        { el: document.getElementById('talent'), color: '#67e8f9' },
        { el: document.getElementById('universities'), color: '#22c55e' },
        { el: document.getElementById('companies'), color: '#f59e0b' },
        { el: document.getElementById('state'), color: '#7c3aed' },
    ];
    
    nodes.forEach(node => {
        const badge = node.el.querySelector('.badge');
        if (badge) badge.style.backgroundColor = node.color;
    });

    let W = 0, H = 0, cx = 0, cy = 0, radiusX = 0, radiusY = 0;
    let t = 0, playing = true, speed = 1, energy = 0;
    const particles = [];
    const linkPaths = [];
    const pathLengths = [];

    function setupSVG() {
        svg.innerHTML = ''; // Clear previous
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        
        for (let i = 0; i < nodes.length; i++) {
            const nextNode = nodes[(i + 1) % nodes.length];
            const grad = document.createElementNS("http://www.w3.org/2000/svg", "linearGradient");
            grad.setAttribute('id', `grad-${i}`);
            grad.innerHTML = `<stop offset="0%" stop-color="${nodes[i].color}" /><stop offset="100%" stop-color="${nextNode.color}" />`;
            defs.appendChild(grad);
            
            const p = document.createElementNS("http://www.w3.org/2000/svg", "path");
            p.setAttribute('fill', 'none');
            p.setAttribute('stroke', `url(#grad-${i})`);
            p.setAttribute('stroke-width', '4');
            p.setAttribute('stroke-linecap', 'round');
            p.setAttribute('opacity', '0.8');
            p.setAttribute('vector-effect', 'non-scaling-stroke');
            linkPaths.push(p);
            svg.appendChild(p);
        }
        svg.appendChild(defs);
    }

    function resize() {
        const rect = stage.getBoundingClientRect();
        W = canvas.width = rect.width * devicePixelRatio;
        H = canvas.height = rect.height * devicePixelRatio;
        canvas.style.width = `${rect.width}px`;
        canvas.style.height = `${rect.height}px`;
        svg.setAttribute('viewBox', `0 0 ${rect.width} ${rect.height}`);
        
        cx = W / 2;
        cy = H / 2;
        radiusX = W * 0.36;
        radiusY = H * 0.36;
    }
    
    const baseAngles = Array.from({ length: nodes.length }, (_, i) => (i / nodes.length) * 2 * Math.PI - Math.PI / 4);

    function positionNodes() {
        const rotation = t * 0.15;
        nodes.forEach((node, i) => {
            const angle = baseAngles[i] + rotation;
            const x = cx + (radiusX + energy * 20) * Math.cos(angle);
            const y = cy + (radiusY + energy * 20) * Math.sin(angle);
            node.el.style.transform = `translate(${(x / devicePixelRatio) - node.el.offsetWidth / 2}px, ${(y / devicePixelRatio) - node.el.offsetHeight / 2}px)`;
        });
        updateLinks();
    }

    function updateLinks() {
        const points = nodes.map(n => ({
            x: n.el.offsetLeft + n.el.offsetWidth / 2,
            y: n.el.offsetTop + n.el.offsetHeight / 2
        }));

        for (let i = 0; i < points.length; i++) {
            const j = (i + 1) % points.length;
            const p0 = points[i], p1 = points[j];
            const dx = p1.x - p0.x, dy = p1.y - p0.y;
            const mx = p0.x + dx * 0.5, my = p0.y + dy * 0.5;
            const nx = -dy, ny = dx;
            const bulge = 0.1 * Math.hypot(dx, dy);
            const cx1 = mx + nx * bulge, cy1 = my + ny * bulge;
            linkPaths[i].setAttribute('d', `M ${p0.x} ${p0.y} Q ${cx1} ${cy1} ${p1.x} ${p1.y}`);
            pathLengths[i] = linkPaths[i].getTotalLength();
        }
    }

    function emitParticle() {
        const pathIndex = Math.floor(Math.random() * nodes.length);
        particles.push({
            pathIndex: pathIndex,
            progress: 0,
            life: 1,
            color: nodes[pathIndex].color,
        });
    }

    function draw() {
        ctx.clearRect(0, 0, W, H);
        for (let i = particles.length - 1; i >= 0; i--) {
            const p = particles[i];
            
            p.progress += (0.0015 * speed) / (pathLengths[p.pathIndex] / 1000); // Normalize speed
            p.life -= 0.005 * speed;

            if (p.progress >= 1 || p.life <= 0) {
                particles.splice(i, 1);
                continue;
            }

            const path = linkPaths[p.pathIndex];
            const len = pathLengths[p.pathIndex];
            if (!len) continue;

            const pt = path.getPointAtLength(p.progress * len);
            
            ctx.beginPath();
            ctx.fillStyle = p.color;
            ctx.globalAlpha = Math.sin(p.progress * Math.PI) * p.life; // Fade in and out
            ctx.arc(
                pt.x * devicePixelRatio, 
                pt.y * devicePixelRatio, 
                2.5 * devicePixelRatio, 
                0, Math.PI * 2
            );
            ctx.fill();
        }
        ctx.globalAlpha = 1;
    }

    function step() {
        if (playing) {
            t += 0.016 * speed;
            energy += (0 - energy) * 0.05; // Dampen energy
            if (Math.random() < 0.2 * speed) emitParticle();
        }
        positionNodes();
        draw();
        requestAnimationFrame(step);
    }

    toggle.addEventListener('click', () => {
        playing = !playing;
        toggle.dataset.state = playing ? 'playing' : 'paused';
        toggle.textContent = playing ? 'Pausar' : 'Reanudar';
    });
    speedEl.addEventListener('input', e => speed = parseFloat(e.target.value));
    pulseBtn.addEventListener('click', () => energy = Math.min(2.5, energy + 1.5));

    setupSVG();
    window.addEventListener('resize', resize, { passive: true });
    resize();
    requestAnimationFrame(step);
})();
</script>
</body>
</html>